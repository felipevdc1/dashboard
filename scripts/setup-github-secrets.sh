#!/bin/bash

# Setup GitHub Actions Secrets
# Este script guia vocÃª para configurar os secrets necessÃ¡rios para sync automÃ¡tico

echo "ðŸ” CONFIGURAÃ‡ÃƒO DE GITHUB ACTIONS SECRETS"
echo "========================================="
echo ""
echo "Para habilitar sync automÃ¡tico 100% funcional, vocÃª precisa"
echo "configurar 5 secrets no repositÃ³rio GitHub."
echo ""
echo "ðŸ“‹ SECRETS NECESSÃRIOS:"
echo ""
echo "1. NEXT_PUBLIC_CARTPANDA_API_URL"
echo "   Valor: https://accounts.cartpanda.com/api/v3"
echo ""
echo "2. CARTPANDA_API_TOKEN"
echo "   Valor: 4QypzWuXZ8LRFlDI1InfE5c0oHvGz9ws6T4AMnqEVEx7VUBkiCF8sDP2j28e"
echo ""
echo "3. CARTPANDA_STORE_NAME"
echo "   Valor: beliuimcaps"
echo ""
echo "4. NEXT_PUBLIC_SUPABASE_URL"
echo "   Valor: https://swogockrnapyymcuorgs.supabase.co"
echo ""
echo "5. NEXT_PUBLIC_SUPABASE_ANON_KEY"
echo "   Valor: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN3b2dvY2tybmFweXltY3VvcmdzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcwNDc1NjAsImV4cCI6MjA2MjYyMzU2MH0._Fo8MF9WTLiCPu112YZLJzszH1rGE3mimX_AaLFHeHQ"
echo ""
echo "========================================="
echo ""
echo "ðŸ“– COMO CONFIGURAR (PASSO A PASSO):"
echo ""
echo "OPÃ‡ÃƒO 1: Via Interface Web (Mais FÃ¡cil)"
echo "----------------------------------------"
echo "1. Acesse: https://github.com/SEU_USUARIO/dashboard/settings/secrets/actions"
echo "2. Clique em 'New repository secret'"
echo "3. Adicione cada secret acima (nome + valor)"
echo "4. Clique em 'Add secret'"
echo "5. Repita para os 5 secrets"
echo ""
echo "OPÃ‡ÃƒO 2: Via GitHub CLI (Mais RÃ¡pido)"
echo "----------------------------------------"
echo "Se vocÃª tem GitHub CLI instalado:"
echo ""
echo "  gh secret set NEXT_PUBLIC_CARTPANDA_API_URL -b'https://accounts.cartpanda.com/api/v3'"
echo "  gh secret set CARTPANDA_API_TOKEN -b'4QypzWuXZ8LRFlDI1InfE5c0oHvGz9ws6T4AMnqEVEx7VUBkiCF8sDP2j28e'"
echo "  gh secret set CARTPANDA_STORE_NAME -b'beliuimcaps'"
echo "  gh secret set NEXT_PUBLIC_SUPABASE_URL -b'https://swogockrnapyymcuorgs.supabase.co'"
echo "  gh secret set NEXT_PUBLIC_SUPABASE_ANON_KEY -b'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN3b2dvY2tybmFweXltY3VvcmdzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcwNDc1NjAsImV4cCI6MjA2MjYyMzU2MH0._Fo8MF9WTLiCPu112YZLJzszH1rGE3mimX_AaLFHeHQ'"
echo ""
echo "========================================="
echo ""
echo "âœ… VERIFICAÃ‡ÃƒO"
echo ""
echo "ApÃ³s configurar os secrets:"
echo ""
echo "1. Acesse: https://github.com/SEU_USUARIO/dashboard/actions"
echo "2. Selecione 'Hourly Incremental Sync'"
echo "3. Clique em 'Run workflow' â†’ 'Run workflow'"
echo "4. Aguarde ~2-5 minutos"
echo "5. Verifique se executou com sucesso (check verde)"
echo ""
echo "Se executar com sucesso, o sync automÃ¡tico estÃ¡ FUNCIONANDO!"
echo ""
echo "========================================="
echo ""
echo "ðŸ“… QUANDO VAI RODAR AUTOMATICAMENTE:"
echo ""
echo "Sync Incremental (4x por dia):"
echo "  - 00:00 UTC (21:00 BrasÃ­lia) âœ…"
echo "  - 06:00 UTC (03:00 BrasÃ­lia) âœ…"
echo "  - 12:00 UTC (09:00 BrasÃ­lia) âœ…"
echo "  - 18:00 UTC (15:00 BrasÃ­lia) âœ…"
echo ""
echo "ValidaÃ§Ã£o DiÃ¡ria (1x por dia):"
echo "  - 09:00 UTC (06:00 BrasÃ­lia) âœ…"
echo ""
echo "========================================="
echo ""
echo "â“ PRECISA DE AJUDA?"
echo ""
echo "DocumentaÃ§Ã£o GitHub Secrets:"
echo "https://docs.github.com/en/actions/security-guides/using-secrets-in-github-actions"
echo ""
echo "Ou execute manualmente:"
echo "  npm run sync:full"
echo ""

# Verificar se GitHub CLI estÃ¡ instalado
if command -v gh &> /dev/null; then
    echo ""
    echo "ðŸŽ‰ GitHub CLI detectado!"
    echo ""
    read -p "Deseja configurar os secrets agora via GitHub CLI? (s/n): " -n 1 -r
    echo ""

    if [[ $REPLY =~ ^[Ss]$ ]]; then
        echo "Configurando secrets..."
        echo ""

        gh secret set NEXT_PUBLIC_CARTPANDA_API_URL -b'https://accounts.cartpanda.com/api/v3' && echo "âœ… NEXT_PUBLIC_CARTPANDA_API_URL configurado"
        gh secret set CARTPANDA_API_TOKEN -b'4QypzWuXZ8LRFlDI1InfE5c0oHvGz9ws6T4AMnqEVEx7VUBkiCF8sDP2j28e' && echo "âœ… CARTPANDA_API_TOKEN configurado"
        gh secret set CARTPANDA_STORE_NAME -b'beliuimcaps' && echo "âœ… CARTPANDA_STORE_NAME configurado"
        gh secret set NEXT_PUBLIC_SUPABASE_URL -b'https://swogockrnapyymcuorgs.supabase.co' && echo "âœ… NEXT_PUBLIC_SUPABASE_URL configurado"
        gh secret set NEXT_PUBLIC_SUPABASE_ANON_KEY -b'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN3b2dvY2tybmFweXltY3VvcmdzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcwNDc1NjAsImV4cCI6MjA2MjYyMzU2MH0._Fo8MF9WTLiCPu112YZLJzszH1rGE3mimX_AaLFHeHQ' && echo "âœ… NEXT_PUBLIC_SUPABASE_ANON_KEY configurado"

        echo ""
        echo "ðŸŽ‰ Secrets configurados com sucesso!"
        echo ""
        echo "Agora teste executando manualmente:"
        echo "  gh workflow run hourly-sync.yml"
        echo ""
        echo "Ou acesse: https://github.com/$(gh repo view --json nameWithOwner -q .nameWithOwner)/actions"
    else
        echo "Ok! Configure manualmente via interface web."
    fi
fi

echo ""
echo "========================================="
echo "ConfiguraÃ§Ã£o concluÃ­da! ðŸš€"
echo "========================================="
